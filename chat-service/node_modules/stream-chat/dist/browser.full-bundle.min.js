!function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var r=n(function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}e.exports=t});var s=function(e){if(Array.isArray(e))return e};var i=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){s=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}return n}};var a=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var o=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}};var c=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var u=function(e,t){return s(e)||i(e,t)||o(e,t)||c()};var l=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s};var h=function(e,t){if(null==e)return{};var n,r,s=l(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s};var f=function(e){if(Array.isArray(e))return a(e)};var p=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var d=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var v=function(e){return f(e)||p(e)||o(e)||d()},y=n(function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",o=s.toStringTag||"@@toStringTag";function c(e,t,n,r){var s=t&&t.prototype instanceof v?t:v,i=Object.create(s.prototype),a=new S(r||[]);return i._invoke=function(e,t,n){var r=l;return function(s,i){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===s)throw i;return O()}for(n.method=s,n.arg=i;;){var a=n.delegate;if(a){var o=C(a,n);if(o){if(o===d)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=u(e,t,n);if("normal"===c.type){if(r=n.done?p:h,c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l="suspendedStart",h="suspendedYield",f="executing",p="completed",d={};function v(){}function y(){}function g(){}var m={};m[i]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(A([])));b&&b!==n&&r.call(b,i)&&(m=b);var k=g.prototype=v.prototype=Object.create(m);function _(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function x(e,t){var n;this._invoke=function(s,i){function a(){return new t(function(n,a){!function n(s,i,a,o){var c=u(e[s],e,i);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,a,o)},function(e){n("throw",e,a,o)}):t.resolve(h).then(function(e){l.value=e,a(l)},function(e){return n("throw",e,a,o)})}o(c.arg)}(s,i,n,a)})}return n=n?n.then(a,a):a()}}function C(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var s=u(r,e.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,d;var i=s.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function U(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(U,this),this.reset(!0)}function A(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function n(){for(;++s<e.length;)if(r.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=k.constructor=g,g.constructor=y,g[o]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},_(x.prototype),x.prototype[a]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,r,s,i){void 0===i&&(i=Promise);var a=new x(c(t,n,r,s),i);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},_(k),k[o]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(r,s){return o.type="throw",o.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return s("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return s(a.catchLoc,!0);if(this.prev<a.finallyLoc)return s(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return s(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return s(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var i=s;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var s=r.arg;R(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});function g(e,t,n,r,s,i,a){try{var o=e[i](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}var m=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function a(e){g(i,r,s,a,o,"next",e)}function o(e){g(i,r,s,a,o,"throw",e)}a(void 0)})}};var w=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e};var _=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},x=n(function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t}),C=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},U=Object.prototype.toString;function R(e){return"[object Array]"===U.call(e)}function S(e){return null!==e&&"object"==typeof e}function A(e){return"[object Function]"===U.call(e)}function O(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),R(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}var E={isArray:R,isArrayBuffer:function(e){return"[object ArrayBuffer]"===U.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:S,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===U.call(e)},isFile:function(e){return"[object File]"===U.call(e)},isBlob:function(e){return"[object Blob]"===U.call(e)},isFunction:A,isStream:function(e){return S(e)&&A(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:O,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,s=arguments.length;r<s;r++)O(arguments[r],n);return t},extend:function(e,t,n){return O(t,function(t,r){e[r]=n&&"function"==typeof t?C(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},I=function(e,t,n,r,s){return function(e,t,n,r,s){return e.config=t,n&&(e.code=n),e.request=r,e.response=s,e}(new Error(e),t,n,r,s)};function j(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var L=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],D=E.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=E.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},T=E.isStandardBrowserEnv()?{write:function(e,t,n,r,s,i){var a=[];a.push(e+"="+encodeURIComponent(t)),E.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),E.isString(r)&&a.push("path="+r),E.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},P=function(e){return new Promise(function(t,n){var r=e.data,s=e.headers;E.isFormData(r)&&delete s["Content-Type"];var i=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",o=e.auth.password||"";s.Authorization="Basic "+btoa(a+":"+o)}if(i.open(e.method.toUpperCase(),function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(E.isURLSearchParams(t))r=t.toString();else{var s=[];E.forEach(t,function(e,t){null!=e&&(E.isArray(e)?t+="[]":e=[e],E.forEach(e,function(e){E.isDate(e)?e=e.toISOString():E.isObject(e)&&(e=JSON.stringify(e)),s.push(j(t)+"="+j(e))}))}),r=s.join("&")}return r&&(e+=(-1===e.indexOf("?")?"?":"&")+r),e}(e.url,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,i.onreadystatechange=function(){if(i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var r,s,a,o,c,u="getAllResponseHeaders"in i?(r=i.getAllResponseHeaders(),c={},r?(E.forEach(r.split("\n"),function(e){if(o=e.indexOf(":"),s=E.trim(e.substr(0,o)).toLowerCase(),a=E.trim(e.substr(o+1)),s){if(c[s]&&L.indexOf(s)>=0)return;c[s]="set-cookie"===s?(c[s]?c[s]:[]).concat([a]):c[s]?c[s]+", "+a:a}}),c):c):null,l={data:e.responseType&&"text"!==e.responseType?i.response:i.responseText,status:i.status,statusText:i.statusText,headers:u,config:e,request:i};!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(I("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}(t,n,l),i=null}},i.onerror=function(){n(I("Network Error",e,null,i)),i=null},i.ontimeout=function(){n(I("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",i)),i=null},E.isStandardBrowserEnv()){var c=T,u=(e.withCredentials||D(e.url))&&e.xsrfCookieName?c.read(e.xsrfCookieName):void 0;u&&(s[e.xsrfHeaderName]=u)}if("setRequestHeader"in i&&E.forEach(s,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete s[t]:i.setRequestHeader(t,e)}),e.withCredentials&&(i.withCredentials=!0),e.responseType)try{i.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){i&&(i.abort(),n(e),i=null)}),void 0===r&&(r=null),i.send(r)})},M={"Content-Type":"application/x-www-form-urlencoded"};function F(e,t){!E.isUndefined(e)&&E.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var B,N={adapter:("undefined"!=typeof XMLHttpRequest?B=P:"undefined"!=typeof process&&(B=P),B),transformRequest:[function(e,t){return function(e,t){E.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})}(t,"Content-Type"),E.isFormData(e)||E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)?e:E.isArrayBufferView(e)?e.buffer:E.isURLSearchParams(e)?(F(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):E.isObject(e)?(F(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};N.headers={common:{Accept:"application/json, text/plain, */*"}},E.forEach(["delete","get","head"],function(e){N.headers[e]={}}),E.forEach(["post","put","patch"],function(e){N.headers[e]=E.merge(M)});var q=N;function W(){this.handlers=[]}W.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},W.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},W.prototype.forEach=function(e){E.forEach(this.handlers,function(t){null!==t&&e(t)})};var H=W,z=function(e,t,n){return E.forEach(n,function(n){e=n(e,t)}),e},J=function(e){return!(!e||!e.__CANCEL__)};function $(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var K=function(e){var t,n,r;return $(e),e.baseURL&&(r=e.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(r))&&(e.url=(t=e.baseURL,(n=e.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=z(e.data,e.headers,e.transformRequest),e.headers=E.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),E.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||q.adapter)(e).then(function(t){return $(e),t.data=z(t.data,t.headers,e.transformResponse),t},function(t){return J(t)||($(e),t&&t.response&&(t.response.data=z(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};function G(e){this.defaults=e,this.interceptors={request:new H,response:new H}}G.prototype.request=function(e){"string"==typeof e&&(e=E.merge({url:arguments[0]},arguments[1])),(e=E.merge(q,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[K,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},E.forEach(["delete","get","head","options"],function(e){G.prototype[e]=function(t,n){return this.request(E.merge(n||{},{method:e,url:t}))}}),E.forEach(["post","put","patch"],function(e){G.prototype[e]=function(t,n,r){return this.request(E.merge(r||{},{method:e,url:t,data:n}))}});var V=G;function X(e){this.message=e}X.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},X.prototype.__CANCEL__=!0;var Y=X;function Q(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new Y(e),t(n.reason))})}Q.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Q.source=function(){var e;return{token:new Q(function(t){e=t}),cancel:e}};var Z=Q;function ee(e){var t=new V(e),n=C(V.prototype.request,t);return E.extend(n,V.prototype,t),E.extend(n,t),n}var te=ee(q);te.Axios=V,te.create=function(e){return ee(E.merge(q,e))},te.Cancel=Y,te.CancelToken=Z,te.isCancel=J,te.all=function(e){return Promise.all(e)},te.spread=function(e){return function(t){return e.apply(null,t)}};var ne=te,re=te;ne.default=re;for(var se=ne,ie=n(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}}),ae=[],oe=0;oe<256;++oe)ae[oe]=(oe+256).toString(16).substr(1);var ce=function(e,t){var n=t||0,r=ae;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")};var ue=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||ie)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var i=0;i<16;++i)t[r+i]=s[i];return t||ce(s)},le=n(function(e,t){!function(){var t=function e(t){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),s=60103,i={use_static:!1};function a(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function o(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:n})}function c(e,t){o(e,t,function(){throw new g("The "+t+" method cannot be invoked on an Immutable data structure.")})}"object"!=typeof(n=t)||Array.isArray(n)||null===n||void 0!==t.use_static&&(i.use_static=Boolean(t.use_static));var u="__immutable_invariants_hold";function l(e){return"object"!=typeof e||null===e||Boolean(Object.getOwnPropertyDescriptor(e,u))}function h(e,t){return e===t||e!=e&&t!=t}function f(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var p=["setPrototypeOf"],d=p.concat(["push","pop","sort","splice","shift","unshift","reverse"]),v=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),y=p.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function g(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function m(e,t){for(var n in o(e,u,!0),t)t.hasOwnProperty(n)&&c(e,t[n]);return Object.freeze(e),e}function w(e,t){var n=e[t];o(e,t,function(){return $(n.apply(e,arguments))})}function b(e,t,n){var r=n&&n.deep;if(e in this&&(r&&this[e]!==t&&f(t)&&f(this[e])&&(t=$.merge(this[e],t,{deep:!0,mode:"replace"})),h(this[e],t)))return this;var s=S.call(this);return s[e]=$(t),x(s)}g.prototype=new Error,g.prototype.constructor=Error;var k=$([]);function _(e,t,n){var r=e[0];if(1===e.length)return b.call(this,r,t,n);var s,i=e.slice(1),a=this[r];if("object"==typeof a&&null!==a)s=$.setIn(a,i,t);else{var o=i[0];s=""!==o&&isFinite(o)?_.call(k,i,t):M.call(P,i,t)}if(r in this&&a===s)return this;var c=S.call(this);return c[r]=s,x(c)}function x(e){for(var t in v)v.hasOwnProperty(t)&&w(e,v[t]);i.use_static||(o(e,"flatMap",U),o(e,"asObject",A),o(e,"asMutable",S),o(e,"set",b),o(e,"setIn",_),o(e,"update",B),o(e,"updateIn",q),o(e,"getIn",W));for(var n=0,r=e.length;n<r;n++)e[n]=$(e[n]);return m(e,d)}function C(){return new Date(this.getTime())}function U(e){if(0===arguments.length)return this;var t,n=[],r=this.length;for(t=0;t<r;t++){var s=e(this[t],t,this);Array.isArray(s)?n.push.apply(n,s):n.push(s)}return x(n)}function R(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach(function(e,t,n){"number"==typeof e&&(n[t]=e.toString())}),e=function(e,n){return-1!==t.indexOf(n)}}var n=a(this);for(var r in this)this.hasOwnProperty(r)&&!1===e(this[r],r)&&(n[r]=this[r]);return J(n)}function S(e){var t,n,r=[];if(e&&e.deep)for(t=0,n=this.length;t<n;t++)r.push(O(this[t]));else for(t=0,n=this.length;t<n;t++)r.push(this[t]);return r}function A(e){"function"!=typeof e&&(e=function(e){return e});var t,n={},r=this.length;for(t=0;t<r;t++){var s=e(this[t],t,this),i=s[0],a=s[1];n[i]=a}return J(n)}function O(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,u)||e instanceof Date?e:$.asMutable(e,{deep:!0})}function E(e,t){for(var n in e)Object.getOwnPropertyDescriptor(e,n)&&(t[n]=e[n]);return t}function I(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var n,r,s=Array.isArray(e),i=t&&t.deep,o=t&&t.mode||"merge",c=t&&t.merger;function u(e,r,s){var o,u=$(r[s]),l=c&&c(e[s],u,t),p=e[s];void 0===n&&void 0===l&&e.hasOwnProperty(s)&&h(u,p)||h(p,o=void 0!==l?l:i&&f(p)&&f(u)?$.merge(p,u,t):u)&&e.hasOwnProperty(s)||(void 0===n&&(n=E(e,a(e))),n[s]=o)}if(s)for(var l=0,p=e.length;l<p;l++){var d=e[l];for(r in d)d.hasOwnProperty(r)&&u(void 0!==n?n:this,d,r)}else{for(r in e)Object.getOwnPropertyDescriptor(e,r)&&u(this,e,r);"replace"===o&&function(e,t){for(var r in e)t.hasOwnProperty(r)||(void 0===n&&(n=E(e,a(e))),delete n[r])}(this,e)}return void 0===n?this:J(n)}function j(e,t){var n=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return $.merge(this,e,{deep:n,mode:"replace"})}var L,D,T,P=$({});function M(e,t,n){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=e[0];if(1===e.length)return F.call(this,r,t,n);var s,i=e.slice(1),o=this[r];if(s=this.hasOwnProperty(r)&&"object"==typeof o&&null!==o?$.setIn(o,i,t):M.call(P,i,t),this.hasOwnProperty(r)&&o===s)return this;var c=E(this,a(this));return c[r]=s,J(c)}function F(e,t,n){var r=n&&n.deep;if(this.hasOwnProperty(e)&&(r&&this[e]!==t&&f(t)&&f(this[e])&&(t=$.merge(this[e],t,{deep:!0,mode:"replace"})),h(this[e],t)))return this;var s=E(this,a(this));return s[e]=$(t),J(s)}function B(e,t){var n=Array.prototype.slice.call(arguments,2),r=this[e];return $.set(this,e,t.apply(r,[r].concat(n)))}function N(e,t){for(var n=0,r=t.length;null!=e&&n<r;n++)e=e[t[n]];return n&&n==r?e:void 0}function q(e,t){var n=Array.prototype.slice.call(arguments,2),r=N(this,e);return $.setIn(this,e,t.apply(r,[r].concat(n)))}function W(e,t){var n=N(this,e);return void 0===n?t:n}function H(e){var t,n=a(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(n[t]=O(this[t]));else for(t in this)this.hasOwnProperty(t)&&(n[t]=this[t]);return n}function z(){return{}}function J(e){return i.use_static||(o(e,"merge",I),o(e,"replace",j),o(e,"without",R),o(e,"asMutable",H),o(e,"set",F),o(e,"setIn",M),o(e,"update",B),o(e,"updateIn",q),o(e,"getIn",W)),m(e,p)}function $(e,t,n){if(l(e)||function(e){return"object"==typeof e&&null!==e&&(e.$$typeof===s||e.$$typeof===r)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then($);if(Array.isArray(e))return x(e.slice());if(e instanceof Date)return a=new Date(e.getTime()),i.use_static||o(a,"asMutable",C),m(a,y);var a,c=t&&t.prototype,u=(c&&c!==Object.prototype?function(){return Object.create(c)}:z)();if(null==n&&(n=64),n<=0)throw new g("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var h in n-=1,e)Object.getOwnPropertyDescriptor(e,h)&&(u[h]=$(e[h],void 0,n));return J(u)}function K(e){return function(){var t=[].slice.call(arguments),n=t.shift();return e.apply(n,t)}}function G(e,t){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?t.apply(r,n):e.apply(r,n)}}return $.from=$,$.isImmutable=l,$.ImmutableError=g,$.merge=K(I),$.replace=K(j),$.without=K(R),$.asMutable=(L=H,D=S,T=C,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?D.apply(t,e):t instanceof Date?T.apply(t,e):L.apply(t,e)}),$.set=G(F,b),$.setIn=G(M,_),$.update=K(B),$.updateIn=K(q),$.getIn=K(W),$.flatMap=K(U),$.asObject=K(A),i.use_static||($.static=e({use_static:!0})),Object.freeze($),$}();e.exports=t}()});le.Immutable;function he(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pe(e,t){return e.created_at-t.created_at}var de=function(){function e(t){w(this,e),_(this,"removeMessageFromArray",function(e,t){var n=!1,r=e.flatMap(function(e){return e.id&&t.id&&e.id===t.id?(n=!0,[]):e});return{removed:n,result:r}}),this._channel=t,this.watcher_count=0,this.typing=le({}),this.read=le({}),this.messages=le([]),this.threads=le({}),this.mutedUsers=le([]),this.watchers=le({}),this.members=le({}),this.membership=le({}),this.last_message_at=null!=t.last_message_at?new Date(t.last_message_at):null}return k(e,[{key:"addMessageSorted",value:function(e){return this.addMessagesSorted([e])}},{key:"messageToImmutable",value:function(e){return e.__html=e.html,e.created_at=new Date(e.created_at),e.updated_at=new Date(e.updated_at),e.status||(e.status="received"),le(e)}},{key:"addMessagesSorted",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[],s=he(e);try{for(s.s();!(t=s.n()).done;){var i=t.value;n&&this.threads[i.id]&&(this.threads=le.without(this.threads,i.id));var a=this.messageToImmutable(i);r.push(a),a.created_at>this.last_message_at&&(this.last_message_at=a.created_at)}}catch(e){s.e(e)}finally{s.f()}for(var o=[],c=0,u=r;c<u.length;c++){var l=u[c];l.parent_id&&!l.show_in_channel||(this.messages=this._addToMessageList(this.messages,l));var h=l.parent_id;if(h){var f=this.threads[h]||le([]),p=this._addToMessageList(f,l);this.threads=this.threads.set(h,p),o.push(h)}}var d=v(this.messages);d.sort(pe),this.messages=le(d);for(var y=0,g=o;y<g.length;y++){var m=g[y],w=this.threads[m]?v(this.threads[m]):[];w.sort(pe),this.threads=this.threads.set(m,w)}}},{key:"addReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,s=t.show_in_channel;if(r&&this.threads[r])for(var i=this.threads[r],a=0;a<i.length;a++){var o=i[a];if(o=this._addReactionToMessage(o,e)){this.threads=this.threads.set(r,i.set(a,o));break}}if(!s&&!r||s)for(var c=0;c<n.length;c++){var u=n[c];if(u=this._addReactionToMessage(u,e)){this.messages=n.set(c,u);break}}}}},{key:"_addReactionToMessage",value:function(e,t){return!(!e.id||e.id!==t.message_id)&&(e=this._removeReactionFromMessage(e,t),this._channel.getClient().userID===t.user.id&&(e=e.update("own_reactions",function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat([t])})),e=(e=e.update("latest_reactions",function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat([t])})).updateIn(["reaction_counts",t.type],function(e){return e?e+1:1}))}},{key:"_removeReactionFromMessage",value:function(e,t){var n=function(e){return e.filter(function(e){return e.type!==t.type||e.user.id!==t.user.id})};return e=(e=e.update("own_reactions",n)).update("latest_reactions",n)}},{key:"removeReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,s=t.show_in_channel;if(r&&this.threads[r])for(var i=this.threads[r],a=0;a<i.length;a++){var o=i[a];if(o.id&&o.id===e.message_id){o=(o=this._removeReactionFromMessage(o,e)).updateIn(["reaction_counts",e.type],function(e){return e?e-1:0}),this.threads=this.threads.set(r,i.set(a,o));break}}if(!s&&!r||s)for(var c=0;c<n.length;c++){var u=n[c];if(u.id&&u.id===e.message_id){u=(u=this._removeReactionFromMessage(u,e)).updateIn(["reaction_counts",e.type],function(e){return e?e-1:0}),this.messages=n.set(c,u);break}}}}},{key:"_addToMessageList",value:function(e,t){for(var n=!1,r=0;r<e.length;r++){var s=e[r];s.id&&t.id&&s.id===t.id&&(e=e.set(r,t),n=!0)}return n||(e=e.concat([t])),e}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,s=n.result;this.threads=this.threads[e.parent_id].set(e.parent_id,s),t=r}else{var i=this.removeMessageFromArray(this.messages,e),a=i.removed,o=i.result;this.messages=o,t=a}return t}},{key:"filterErrorMessages",value:function(){var e=this.messages.flatMap(function(e){return"error"!==e.type?e:[]});this.messages=le(e)}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=u(n[t],2),s=r[0],i=r[1];e-new Date(i.received_at)>7e3&&(this.typing=this.typing.without(s),this._channel.getClient().dispatchEvent({type:"typing.stop",user:{id:s},cid:this._channel.cid}))}}},{key:"clearMessages",value:function(){this.messages=le([])}}]),e}(),ve={"user.presence.changed":!0,"user.watching.start":!0,"user.watching.stop":!0,"user.updated":!0,"user.deleted":!0,"typing.start":!0,"typing.stop":!0,"message.new":!0,"message.updated":!0,"message.deleted":!0,"message.read":!0,"reaction.new":!0,"reaction.deleted":!0,"member.added":!0,"member.updated":!0,"member.removed":!0,"channel.updated":!0,"channel.muted":!0,"channel.unmuted":!0,"channel.deleted":!0,"channel.truncated":!0,"channel.created":!0,"channel.hidden":!0,"channel.visible":!0,"health.check":!0,"notification.message_new":!0,"notification.mark_read":!0,"notification.invited":!0,"notification.invite_accepted":!0,"notification.added_to_channel":!0,"notification.removed_from_channel":!0,"notification.mutes_updated":!0,"notification.channel_deleted":!0,"notification.channel_truncated":!0,"notification.channel_mutes_updated":!0,"connection.changed":!0,"connection.recovered":!0};function ye(e){return"all"===e||(ve[e]||!1)}function ge(e,t){e.then(function(){}).catch(function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)})}var me=function(e){return new Promise(function(t){return setTimeout(t,e)})};function we(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var be={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function ke(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return _e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _e(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ue=function(){function e(t,n,r,s){var i=this;w(this,e),_(this,"create",m(y.mark(function e(){var t;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={watch:!1,state:!1,presence:!1},e.next=3,i.query(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}))),_(this,"_callChannelListeners",function(e){var t=i,n=[];t.listeners.all&&n.push.apply(n,v(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,v(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){(0,s[r])(e)}}),_(this,"_channelURL",function(){if(!i.id)throw new Error("channel id is not defined");return"".concat(i.getClient().baseURL,"/channels/").concat(i.type,"/").concat(i.id)});if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if(!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=s,this._data=Ce({},s),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new de(this),this.initialized=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}return k(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.type]}},{key:"sendMessage",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",{message:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=m(y.mark(function e(t){var n,r,s=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},r=Ce({filter_conditions:{cid:this.cid}},n),"string"!=typeof t){e.next=6;break}r.query=t,e.next=11;break;case 6:if("object"!==x(t)){e.next=10;break}r.message_filter_conditions=t,e.next=11;break;case 10:throw Error("Invalid type ".concat(x(t)," for query parameter"));case 11:return e.next=13,this.wsPromise;case 13:return e.next=15,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryMembers",value:function(){var e=m(y.mark(function e(t){var n,r,s,i,a,o,c,l,h,f,p,d=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=d.length>1&&void 0!==d[1]?d[1]:{},r=d.length>2&&void 0!==d[2]?d[2]:{},s=[],i=0,a=Object.entries(n);i<a.length;i++)o=u(a[i],2),c=o[0],l=o[1],s.push({field:c,direction:l});return f=this.type,this.id?h=this.id:this.data&&Array.isArray(this.data.members)&&(p=this.data.members),e.next=8,this.getClient().get(this.getClient().baseURL+"/members",{payload:Ce({type:f,id:h,members:p,sort:s,filter_conditions:t},r)});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendReaction",value:function(){var e=m(y.mark(function e(t,n,r){var s;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return s={reaction:n},null!=r&&(s.reaction=Ce(Ce({},n),{},{user:{id:r}})),e.next=8,this.getClient().post(this.getClient().baseURL+"/messages/".concat(t,"/reaction"),s);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(e,"/reaction/").concat(t);return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r)}},{key:"update",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{message:n,data:t});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=m(y.mark(function e(){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().delete(this._channelURL());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"truncate",value:function(){var e=m(y.mark(function e(){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/truncate");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"acceptInvite",value:function(){var e=m(y.mark(function e(){var t,n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),Ce({accept_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rejectInvite",value:function(){var e=m(y.mark(function e(){var t,n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),Ce({reject_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addMembers",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addModerators",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"inviteMembers",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{invites:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeMembers",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{remove_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"demoteModerators",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{demote_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"mute",value:function(){var e=m(y.mark(function e(){var t,n=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",Ce({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unmute",value:function(){var e=m(y.mark(function e(){var t,n=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",Ce({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(e,"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:function(){var e=m(y.mark(function e(){var t,n;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getConfig().typing_events){e.next=2;break}return e.abrupt("return");case 2:if(t=new Date,n=t-this.lastTypingEvent,this.lastKeyStroke=t,this.isTyping=!0,!(n>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent({type:"typing.start"});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"stopTyping",value:function(){var e=m(y.mark(function e(){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.getConfig().typing_events){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent({type:"typing.stop"});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"lastMessage",value:function(){var e=this.state.messages.length-5;e<0&&(e=0);var t,n=this.state.messages.length+1,r=this.state.messages.slice(e,n).asMutable();return r.sort(function(e,t){return t.created_at-e.created_at}),r.length>0&&(t=r[0]),t}},{key:"markRead",value:function(){var e=m(y.mark(function e(){var t,n=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this._checkInitialized(),this.getConfig().read_events){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",Ce({},t));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clean",value:function(){this.lastKeyStroke&&(new Date-this.lastKeyStroke>1e3&&this.isTyping&&ge(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:function(){var e=m(y.mark(function e(t){var n,r,s;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=Ce(Ce({},n),t),e.next=7,this.query(r);case 7:return s=e.sent,this.initialized=!0,this._initializeState(s),this.data=s.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",s);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopWatching",value:function(){var e=m(y.mark(function e(){var t;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getReplies",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().get(this.getClient().baseURL+"/messages/".concat(t,"/replies"),Ce({},n));case 2:return(r=e.sent).messages&&this.state.addMessagesSorted(r.messages),e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(e,"/reactions"),Ce({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){return this._checkInitialized(),this.state.read[this.getClient().userID]?this.state.read[this.getClient().userID].last_read:null}},{key:"countUnread",value:function(e){null==e&&(e=this.lastRead());var t,n=0,r=ke(this.state.messages);try{for(r.s();!(t=r.n()).done;){var s=t.value;this.getClient().userID!==s.user.id&&(s.silent||(null!=e?s.created_at>e&&n++:n++))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"countUnreadMentions",value:function(){var e,t=this,n=this.lastRead(),r=0,s=ke(this.state.messages);try{for(s.s();!(e=s.n()).done;){var i=e.value;this.getClient().userID!==i.user.id&&(i.silent||(null!=n?i.created_at>n&&function(){var e=t.getClient().userID;-1!==i.mentioned_users.findIndex(function(t){return t.id===e})&&r++}():r++))}}catch(e){s.e(e)}finally{s.f()}return r}},{key:"query",value:function(){var e=m(y.mark(function e(t){var n,r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().wsPromise;case 2:return n="".concat(this.getClient().baseURL,"/channels/").concat(this.type),this.id&&(n+="/".concat(this.id)),e.next=6,this.getClient().post(n+"/query",Ce({data:this._data,state:!0},t));case 6:return r=e.sent,this.id||(this.id=r.channel.id,this.cid=r.channel.cid,this.cid in this.getClient().activeChannels||(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(r),this._initializeState(r),e.abrupt("return",r);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"banUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,Ce(Ce({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"hide",value:function(){var e=m(y.mark(function e(){var t,n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"show",value:function(){var e=m(y.mark(function e(){var t,n=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"unbanUser",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){var n=t?e:"all";if(!ye(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Attaching listener for ".concat(n," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n].push(r)}},{key:"off",value:function(e,t){var n=t?e:"all";if(!ye(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_handleChannelEvent",value:function(e){this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var t=this.state;switch(e.type){case"typing.start":t.typing=t.typing.set(e.user.id,le(e));break;case"typing.stop":t.typing=t.typing.without(e.user.id);break;case"message.read":t.read=t.read.set(e.user.id,le({user:Ce({},e.user),last_read:e.received_at}));break;case"user.watching.start":case"user.updated":t.watchers=t.watchers.set(e.user.id,le(e.user));break;case"user.watching.stop":t.watchers=t.watchers.without(e.user.id);break;case"message.new":case"message.updated":case"message.deleted":t.addMessageSorted(e.message);break;case"channel.truncated":t.clearMessages();break;case"member.added":case"member.updated":t.members=t.members.set(e.member.user_id,le(e.member));break;case"member.removed":t.members=t.members.without(e.user.id);break;case"channel.updated":this.data=le(e.channel);break;case"reaction.new":t.addReaction(e.reaction,e.message);break;case"reaction.deleted":t.removeReaction(e.reaction,e.message);break;case"channel.hidden":e.clear_history&&t.clearMessages()}void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){if(e.members){var t,n=ke(e.members);try{for(n.s();!(t=n.n()).done;){var s=t.value;this.getClient().state.updateUserReference(s.user,this.cid)}}catch(e){n.e(e)}finally{n.f()}}if(this.state.membership=le(e.membership?e.membership:{}),e.watchers){var i,a=ke(e.watchers);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.getClient().state.updateUserReference(o.user,this.cid)}}catch(e){a.e(e)}finally{a.f()}}var c=e.messages||[];if(this.state.messages||(this.state.messages=le([])),this.state.addMessagesSorted(c,!0),this.state.watcher_count=e.watcher_count,e.watchers){var u,l=ke(e.watchers);try{for(l.s();!(u=l.n()).done;){var h=u.value;this.state.watchers=this.state.watchers.set(h.id,h)}}catch(e){l.e(e)}finally{l.f()}}if(null!=this.getClient().userID){var f=null!=this.state.last_message_at?this.state.last_message_at:new Date;this.state.read=this.state.read.set(this.getClient().user.id,{user:this.getClient().user,last_read:f})}if(e.read){var p,d=ke(e.read);try{for(d.s();!(p=d.n()).done;){var v=p.value,y=r(Ce({},v));y.last_read=new Date(v.last_read),this.state.read=this.state.read.set(v.user.id,y)}}catch(e){d.e(e)}finally{d.f()}}if(e.members){var g,m=ke(e.members);try{for(m.s();!(g=m.n()).done;){var w=g.value;this.state.members=this.state.members.set(w.user.id,w)}}catch(e){m.e(e)}finally{m.f()}}}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0}}]),e}();function Re(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return Se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Se(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ae=function(){function e(){w(this,e),this.users=le({}),this.userChannelReferences={}}return k(e,[{key:"updateUsers",value:function(e){var t,n=Re(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&(this.users=this.users.set(e.id,le(e)))}},{key:"updateUserReference",value:function(e,t){null!=e&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}}]),e}(),Oe=null;"undefined"!=typeof WebSocket?Oe=WebSocket:"undefined"!=typeof MozWebSocket?Oe=MozWebSocket:void 0!==t?Oe=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?Oe=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(Oe=self.WebSocket||self.MozWebSocket);for(var Ee=Oe,Ie=function(){function e(t){var n=this,r=t.wsBaseURL,s=t.clientID,i=t.userID,a=t.user,o=t.userAgent,c=t.apiKey,u=t.tokenManager,l=t.authType,h=t.messageCallback,f=t.recoverCallback,p=t.eventCallback,d=t.logger;w(this,e),_(this,"_buildUrl",function(){var e={user_id:n.user.id,user_details:n.user,user_token:n.tokenManager.getToken(),server_determines_connection_id:!0},t=encodeURIComponent(JSON.stringify(e)),r=n.tokenManager.getToken();return"".concat(n.wsBaseURL,"/connect?json=").concat(t,"&api_key=").concat(n.apiKey,"&authorization=").concat(r,"&stream-auth-type=").concat(n.authType,"&x-stream-client=").concat(n.userAgent)}),_(this,"onlineStatusChanged",function(e){"offline"===e.type?(n.logger("info","connection:onlineStatusChanged() - Status changing to offline",{tags:["connection"]}),n._setHealth(!1)):"online"===e.type&&(n.logger("info","connection:onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy),{tags:["connection"]}),n.isHealthy||n._reconnect({interval:10}))}),_(this,"onopen",function(e){n.wsID===e&&(n.logger("info","connection:onopen() - onopen callback",{tags:["connection"],wsID:e}),n._setHealth(!0))}),_(this,"onmessage",function(e,t){if(n.wsID===e){if(!n.isResolved){var r=JSON.parse(t.data);if(null!=r.error)return void n.rejectPromise(n._errorFromWSEvent(r.error,!1));n.resolvePromise(t)}n.lastEvent=new Date,n.logger("info","connection:onmessage() - onmessage callback",{tags:["connection"],event:t,wsID:e}),n.messageCallback(t)}}),_(this,"onclose",function(e,t){if(n.logger("info","connection:onclose() - onclose callback - "+t.code,{tags:["connection"],event:t,wsID:e}),n.wsID===e)if(t.code===be.WS_CLOSED_SUCCESS){var r=new Error("WS connection reject with error ".concat(t.reason));r.reason=t.reason,n.rejectPromise(r),n.logger("info","connection:onclose() - WS connection reject with error ".concat(t.reason),{tags:["connection"],event:t})}else n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.rejectPromise(n._errorFromWSEvent(t)),n.logger("info","connection:onclose() - WS connection closed. Calling reconnect ...",{tags:["connection"],event:t}),n._reconnect()}),_(this,"onerror",function(e,t){n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.rejectPromise(n._errorFromWSEvent(t)),n.logger("info","connection:onerror() - WS connection resulted into error",{tags:["connection"],event:t}),n._reconnect())}),_(this,"_setHealth",function(e){e&&!n.isHealthy&&(n.isHealthy=!0,n.eventCallback({type:"connection.changed",online:!0})),!e&&n.isHealthy&&(n.isHealthy=!1,setTimeout(function(){n.isHealthy||n.eventCallback({type:"connection.changed",online:!1})},5e3))}),_(this,"_errorFromWSEvent",function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n.logger("warn","connection:_errorFromWSEvent() - WS failed with code ".concat(e.code),{tags:["connection"],event:e});var r=new Error("WS failed with code ".concat(e.code," and reason - ").concat(e.message));return r.code=e.code,r.StatusCode=e.StatusCode,r.isWSFailure=t,r}),_(this,"_listenForConnectionChanges",function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.addEventListener("offline",n.onlineStatusChanged),window.addEventListener("online",n.onlineStatusChanged))}),_(this,"_removeConnectionListeners",function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.removeEventListener("offline",n.onlineStatusChanged),window.removeEventListener("online",n.onlineStatusChanged))}),_(this,"_retryInterval",function(){var e=Math.min(500+2e3*n.consecutiveFailures,25e3),t=Math.min(Math.max(250,2e3*(n.consecutiveFailures-1)),25e3);return Math.floor(Math.random()*(e-t)+t)}),_(this,"_setupConnectionPromise",function(){var e=n;n.isResolved=!1,n.connectionOpen=new Promise(function(t,n){e.resolvePromise=t,e.rejectPromise=n}).then(function(e){var t=JSON.parse(e.data);if(null!=t.error)throw new Error(JSON.stringify(t.error));return t},function(e){throw e})}),this.wsBaseURL=r,this.clientID=s,this.userID=i,this.user=a,this.authType=l,this.userAgent=o,this.apiKey=c,this.tokenManager=u,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isHealthy=!1,this.recoverCallback=f,this.messageCallback=h,this.eventCallback=p,this.logger=d,this.wsID=1,this.lastEvent=null,this.healthCheckInterval=3e4,this.monitorInterval=1e3,this._listenForConnectionChanges()}return k(e,[{key:"connect",value:function(){var e=m(y.mark(function e(){var t;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConnecting){e.next=2;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 2:return e.prev=2,this.isConnecting=!0,e.next=6,this._connect();case 6:return t=e.sent,this.isConnecting=!1,this.consecutiveFailures=0,this._startMonitor(),this._startHealthCheck(),this.logger("info","connection:connect() - Established ws connection with healthcheck: ".concat(t),{tags:["connection"]}),e.abrupt("return",t);case 15:if(e.prev=15,e.t0=e.catch(2),this.isConnecting=!1,this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==be.TOKEN_EXPIRED||this.tokenManager.isStatic()){e.next=23;break}return this.logger("info","connection:connect() - WS failure due to expired token, so going to try to reload token and reconnect",{tags:["connection"]}),e.abrupt("return",this._reconnect({refreshToken:!0}));case 23:if(e.t0.isWSFailure){e.next=25;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 25:case"end":return e.stop()}},e,this,[[2,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(e){var t,n=this;this.logger("info","connection:disconnect() - Closing the websocket connection for wsID ".concat(this.wsID),{tags:["connection"]}),this.wsID+=1,this.healthCheckIntervalRef&&clearInterval(this.healthCheckIntervalRef),this.monitorIntervalRef&&clearInterval(this.monitorIntervalRef),this._removeConnectionListeners(),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise(function(t){var s=function(e){n.logger("info","connection:disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{tags:["connection"],event:e}),t()};r.onclose=s,setTimeout(s,null!=e?e:1e3)}),this.logger("info","connection:disconnect() - Manually closed connection by calling client.disconnect()",{tags:["connection"]}),r.close(be.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this.logger("info","connection:disconnect() - ws connection doesn't exist or it is already closed.",{tags:["connection"]}),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:function(){var e=m(y.mark(function e(){var t,n;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenManager.tokenReady();case 2:return this._setupConnectionPromise(),t=this._buildUrl(),this.ws=new Ee(t),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=11,this.connectionOpen;case 11:return n=e.sent,this.connectionID=n.connection_id,e.abrupt("return",n);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_reconnect",value:function(){var e=m(y.mark(function e(){var t,n,r,s=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},this.logger("info","connection:_reconnect() - Initiating the reconnect",{tags:["connection"]}),!this.isConnecting&&!this.isHealthy){e.next=5;break}return this.logger("info","connection:_reconnect() - Abort (1) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 5:return(n=t.interval)||(n=this._retryInterval()),e.next=9,me(n);case 9:if(!this.isConnecting&&!this.isHealthy){e.next=12;break}return this.logger("info","connection:_reconnect() - Abort (2) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 12:if(this.isConnecting=!0,this.logger("info","connection:_reconnect() - Destroying current WS connection",{tags:["connection"]}),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=18;break}return e.next=18,this.tokenManager.loadToken();case 18:return e.prev=18,e.next=21,this._connect();case 21:if(r=e.sent,!this.recoverCallback){e.next=27;break}return this.logger("info","connection:_reconnect() - Waiting for recoverCallBack",{tags:["connection"]}),e.next=26,this.recoverCallback(r);case 26:this.logger("info","connection:_reconnect() - Finished recoverCallBack",{tags:["connection"]});case 27:this.isConnecting=!1,this.consecutiveFailures=0,e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(18),this.isConnecting=!1,this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==be.TOKEN_EXPIRED||this.tokenManager.isStatic()){e.next=39;break}return this.logger("info","connection:_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect",{tags:["connection"]}),e.abrupt("return",this._reconnect({refreshToken:!0}));case 39:e.t0.isWSFailure&&(this.logger("info","connection:_reconnect() - WS failure, so going to try to reconnect",{tags:["connection"]}),this._reconnect());case 40:this.logger("info","connection:_reconnect() - == END ==",{tags:["connection"]});case 41:case"end":return e.stop()}},e,this,[[18,31]])}));return function(){return e.apply(this,arguments)}}()},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners(),this.ws&&this.ws.close&&this.ws.close()}catch(e){}}},{key:"_startHealthCheck",value:function(){var e=this;this.healthCheckIntervalRef=setInterval(function(){var t=[{type:"health.check",client_id:e.clientID,user_id:e.userID}];try{e.ws.send(JSON.stringify(t))}catch(e){}},e.healthCheckInterval)}},{key:"_startMonitor",value:function(){var e=this,t=this;this.monitorIntervalRef=setInterval(function(){new Date-t.lastEvent>e.healthCheckInterval+1e4&&(e.logger("info","connection:_startMonitor - going to reconnect",{tags:["connection"]}),t._setHealth(!1),t._reconnect())},t.monitorInterval)}}]),e}(),je=null,Le=null,De=function(e){for(var t,n=e.length,r=n%3,s=[],i=0,a=n-r;i<a;i+=16383)s.push(Ne(e,i,i+16383>a?a:i+16383));1===r?(t=e[n-1],s.push(Te[t>>2]+Te[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(Te[t>>10]+Te[t>>4&63]+Te[t<<2&63]+"="));return s.join("")},Te=[],Pe=[],Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fe=0,Be=Me.length;Fe<Be;++Fe)Te[Fe]=Me[Fe],Pe[Me.charCodeAt(Fe)]=Fe;function Ne(e,t,n){for(var r,s,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(Te[(s=r)>>18&63]+Te[s>>12&63]+Te[s>>6&63]+Te[63&s]);return i.join("")}Pe["-".charCodeAt(0)]=62,Pe["_".charCodeAt(0)]=63;var qe=function(e,t){for(var n,r=[],s=0,i=e.length;s<i;s++)"string"==typeof e&&e.charAt(s)?(n=t(e.charAt(s),s,e),r[s]=n):"string"!=typeof e&&s in e&&(n=t(e[s],s,e),r[s]=n);return r};function We(e){return De(qe(e,function(e){return e.charCodeAt(0)}))}function He(e){var t,n,r,s={},i=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+s[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=i(r));return u}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Je(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"!=typeof t)throw new TypeError("userId should be a string");!function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}}({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function $e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r({algorithm:"HS256",noTimestamp:!0},t);return je.sign({server:!0},e,n)}function Ke(e){var t=e.split(".");if(3!==t.length)return"";var n=He(t[1]);return JSON.parse(n).user_id}function Ge(e){return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",We(JSON.stringify({user_id:e})),"devtoken"].join(".")}function Ve(e,t,n){var r=Buffer.from(t,"ascii");return Le.createHmac("sha256",r).update(e).digest("hex")===n}var Xe=null,Ye=null,Qe="object"==typeof self?self.FormData:window.FormData,Ze="1.14.1",et=function e(t){var n=this;w(this,e),_(this,"setTokenOrProvider",function(){var e=m(y.mark(function e(t,r){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.validateToken(t,r),n.user=r,we(t)&&(n.tokenProvider=t,n.type="provider"),"string"==typeof t&&(n.token=t,n.type="static"),!t&&n.user&&n.secret&&(n.token=Je(n.secret,r.id,{},{}),n.type="static"),e.next=7,n.loadToken();case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),_(this,"reset",function(){n.token=null,n.user=null,n.loadTokenPromise=null}),_(this,"validateToken",function(e,t){if(!t||!t.anon||e){if(!n.secret&&!e)throw new Error("User token can not be empty");if(e&&"string"!=typeof e&&!we(e))throw new Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var r=Ke(e);if(null!=e&&(null==r||""===r||r!==t.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}}),_(this,"tokenReady",function(){return n.loadTokenPromise}),_(this,"loadToken",function(){return n.loadTokenPromise=new Promise(function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==n.type){e.next=2;break}return e.abrupt("return",t(n.token));case 2:return e.next=4,n.tokenProvider();case 4:n.token=e.sent,t(n.token);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.loadTokenPromise}),_(this,"getToken",function(){if(n.token)return n.token;if(n.user&&n.user.anon&&!n.token)return n.token;if(n.secret)return $e(n.secret);throw new Error("Both secret and user tokens are not set. Either client.setUser wasn't called or client.disconnect was called")}),_(this,"isStatic",function(){return"static"===n.type}),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=$e(this.secret))};function tt(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nt(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,i=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw s}}}}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var it=function(){function e(t,n,r){var s=this;w(this,e),_(this,"_setupConnection",function(){return s.UUID=ue(),s.clientID="".concat(s.userID,"--").concat(s.UUID),s.wsPromise=s.connect(),s._startCleaning(),s.wsPromise}),_(this,"_hasConnectionID",function(){return Boolean(s.connectionID)}),_(this,"setUser",function(e,t){if(s.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. setUser was called twice.");if(s.userID=e.id,!s.userID)throw new Error('The "id" field on the user is missing');var n=s._setToken(e,t);s._setUser(e);var r=s._setupConnection();return s.anonymous=!1,s.setUserPromise=Promise.all([n,r]).then(function(e){return e[1]}).catch(function(e){throw e}),s.setUserPromise}),_(this,"_setToken",function(e,t){return s.tokenManager.setTokenOrProvider(t,e)}),_(this,"setAnonymousUser",function(){s.anonymous=!0,s.userID=ue();var e={id:s.userID,anon:!0};return s._setToken(e,""),s._setUser(e),s._setupConnection()}),_(this,"doAxiosRequest",function(){var e=m(y.mark(function e(t,n,r){var i,a,o,c=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{},e.next=3,s.tokenManager.tokenReady();case 3:a=s._enrichAxiosOptions(i),e.prev=4,s._logApiRequest(t,n,r,a),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"put"===e.t0?21:"patch"===e.t0?25:29;break;case 9:return e.next=11,s.axiosInstance.get(n,a);case 11:return o=e.sent,e.abrupt("break",30);case 13:return e.next=15,s.axiosInstance.delete(n,a);case 15:return o=e.sent,e.abrupt("break",30);case 17:return e.next=19,s.axiosInstance.post(n,r,a);case 19:return o=e.sent,e.abrupt("break",30);case 21:return e.next=23,s.axiosInstance.put(n,r,a);case 23:return o=e.sent,e.abrupt("break",30);case 25:return e.next=27,s.axiosInstance.patch(n,r,a);case 27:return o=e.sent,e.abrupt("break",30);case 29:return e.abrupt("break",30);case 30:return s._logApiResponse(t,n,o),e.abrupt("return",s.handleResponse(o));case 34:if(e.prev=34,e.t1=e.catch(4),s._logApiError(t,n,e.t1),!e.t1.response){e.next=46;break}if(e.t1.response.data.code!==be.TOKEN_EXPIRED||s.tokenManager.isStatic()){e.next=43;break}return s.tokenManager.loadToken(),e.next=42,s.doAxiosRequest(t,n,r,i);case 42:return e.abrupt("return",e.sent);case 43:return e.abrupt("return",s.handleResponse(e.t1.response));case 46:throw e.t1;case 47:case"end":return e.stop()}},e,null,[[4,34]])}));return function(t,n,r){return e.apply(this,arguments)}}()),_(this,"dispatchEvent",function(e){s._handleClientEvent(e);var t=e.cid,n=s.activeChannels[t];n&&n._handleChannelEvent(e),s._callClientListeners(e),n&&n._callChannelListeners(e)}),_(this,"handleEvent",function(e){var t=e.data,n=JSON.parse(t);n.received_at=new Date,s.dispatchEvent(n)}),_(this,"_callClientListeners",function(e){var t=s,n=[];t.listeners.all&&n.push.apply(n,v(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,v(t.listeners[e.type]));for(var r=0,i=n;r<i.length;r++){(0,i[r])(e)}}),_(this,"recoverState",m(y.mark(function e(){var t,n,r,i,a,o,c;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(s.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(s.wsConnection.connectionID),{tags:["connection"]}),s.connectionID=s.wsConnection.connectionID,t=Object.keys(s.activeChannels),n={},r=0,i=Object.values(s.activeChannels);r<i.length;r++)a=i[r],o=a.lastMessage(),c=void 0,o&&(c=o.id),n[a.cid]=c;if(!t.length){e.next=11;break}return s.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=9,s.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30,recovery:!0,last_message_ids:n});case 9:s.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),s.dispatchEvent({type:"connection.recovered"});case 11:s.wsPromise=Promise.resolve(),s.setUserPromise=Promise.resolve();case 13:case"end":return e.stop()}},e)}))),_(this,"_isUsingServerAuth",function(){return!!s.secret}),this.key=t,this.secret=null,this.listeners={},this.state=new Ae,this.mutedChannels=[],n&&n.indexOf&&(this.secret=n),(r=r||n)||(r={}),this.browser=void 0!==r.browser?r.browser:"undefined"!=typeof window,this.node=!this.browser;var i={timeout:3e3,withCredentials:!1};if(this.node){var a={httpAgent:new Xe.Agent({keepAlive:3e3}),httpsAgent:new Ye.Agent({keepAlive:3e3})};this.options=st(st(st({},a),i),r)}else this.options=st(st({},i),r),delete this.options.httpAgent,delete this.options.httpsAgent;this.axiosInstance=se.create(this.options),this.setBaseURL("https://chat-us-east-1.stream-io-api.com"),"undefined"!=typeof process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.tokenManager=new et(this.secret),this.logger=we(r.logger)?r.logger:function(){}}return k(e,[{key:"devToken",value:function(e){return Ge(e)}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws")}},{key:"_setUser",value:function(e){this.user=e,this._user=st({},e)}},{key:"updateAppSettings",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.apn_config&&t.apn_config.p12_cert&&(t.apn_config.p12_cert=Buffer.from(t.apn_config.p12_cert).toString("base64")),e.next=3,this.patch(this.baseURL+"/app",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getAppSettings",value:function(){var e=m(y.mark(function e(){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"testPushSettings",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",st(st(st(st({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(e){this.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete this.user,delete this._user,delete this.userID,null!=this.cleaningIntervalRef&&(clearInterval(this.cleaningIntervalRef),this.cleaningIntervalRef=null),this.anonymous=!1,this.connectionEstablishedCount=0;for(var t=0,n=Object.values(this.activeChannels);t<n.length;t++){n[t]._disconnect()}return this.activeChannels={},this.state=new Ae,this.tokenManager.reset(),this.wsConnection?this.wsConnection.disconnect(e):Promise.resolve()}},{key:"setGuestUser",value:function(){var e=m(y.mark(function e(t){var n,r,s;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,r=n.user,r.created_at,r.updated_at,r.last_active,r.online,s=h(r,["created_at","updated_at","last_active","online"]),e.next=15,this.setUser(s,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this,[[1,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"createToken",value:function(e,t){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var n={};return t&&(n.exp=t),Je(this.secret,e,n,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all";if(!ye(r))throw Error("Invalid event type ".concat(r));var s=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(s),{unsubscribe:function(){n.listeners[r]=n.listeners[r].filter(function(e){return e!==s})}}}},{key:"off",value:function(e,t){var n=t?e:"all";if(!ye(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter(function(e){return e!==r})}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,s){var i,a,o=new Qe;return null!==(a=t)&&"object"===x(a)&&"function"==typeof a._read&&"object"===x(a._readableState)||t instanceof File?i=t:(i={uri:t,name:n||t.split("/").reverse()[0]},null!=r&&(i.type=r)),null!=s&&o.append("user",JSON.stringify(s)),o.append("file",i),this.doAxiosRequest("post",e,o,{headers:o.getHeaders?o.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new Error("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t=e.data;if("2"!==(e.status+"")[0])throw this.errorFromResponse(e);return t}},{key:"_handleClientEvent",value:function(e){var t=this;this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),"user.presence.changed"!==e.type&&"user.updated"!==e.type||(e.user.id===this.userID&&(this.user=st(st({},this.user),e.user),Object.keys(e.user).forEach(function(n){n in t._user&&(t._user[n]=e.user[n])})),t.state.updateUser(e.user),t._updateUserReferences(e.user)),"health.check"===e.type&&e.me&&(t.user=e.me,t.state.updateUser(e.me),t.mutedChannels=e.me.channel_mutes),"notification.message_new"===e.type&&(this.configs[e.channel.type]=e.channel.config),"notification.channel_mutes_updated"===e.type&&(this.mutedChannels=e.me.channel_mutes)}},{key:"_muteStatus",value:function(e){var t;return this.mutedChannels.forEach(function(n){if(n.channel.cid===e){var r=!0;n.expires&&(r=new Date(n.expires).getTime()>(new Date).getTime()),t={muted:r,createdAt:new Date(n.created_at),expiresAt:n.expires?new Date(n.expires):null}}}),t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"_updateUserReferences",value:function(e){for(var t=this.state.userChannelReferences[e.id]||{},n=0,r=Object.keys(t);n<r.length;n++){var s=r[n],i=this.activeChannels[s];i&&i.state&&(i.state.members[e.id]&&(i.state.members=i.state.members.setIn([e.id,"user"],e)),i.state.watchers[e.id]&&(i.state.watchers=i.state.watchers.setIn([e.id,"user"],e)))}}},{key:"connect",value:function(){var e=m(y.mark(function e(){var t,n;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connecting=!0,t=this,this.failures=0,null!=t.userID){e.next=5;break}throw Error("Call setUser or setAnonymousUser before starting the connection");case 5:return this.wsConnection=new Ie({wsBaseURL:t.wsBaseURL,tokenManager:t.tokenManager,user:this._user,authType:this.getAuthType(),userAgent:this._userAgent(),apiKey:this.key,recoverCallback:this.recoverState,messageCallback:this.handleEvent,eventCallback:this.dispatchEvent,logger:this.logger}),e.next=8,this.wsConnection.connect();case 8:return n=e.sent,this.connectionID=this.wsConnection.connectionID,e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"queryUsers",value:function(){var e=m(y.mark(function e(t,n,r){var s,i,a,o,c,l,h,f;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n||(n={}),r||(r={}),s=[],i=0,a=Object.entries(n);i<a.length;i++)o=u(a[i],2),c=o[0],l=o[1],s.push({field:c,direction:l});return h={presence:!1},e.next=7,this.setUserPromise;case 7:return this._hasConnectionID()||(h.presence=!1),e.next=10,this.get(this.baseURL+"/users",{payload:st(st({filter_conditions:t,sort:s},h),r)});case 10:return f=e.sent,this.state.updateUsers(f.users),e.abrupt("return",f);case 13:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"queryChannels",value:function(){var e=m(y.mark(function e(t){var n,r,s,i,a,o,c,l,h,f,p,d,v,g,m,w,b,k,_,x=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=x.length>1&&void 0!==x[1]?x[1]:{},r=x.length>2&&void 0!==x[2]?x[2]:{},s=[],i=0,a=Object.entries(n);i<a.length;i++)o=u(a[i],2),c=o[0],l=o[1],s.push({field:c,direction:l});return h={state:!0,watch:!0,presence:!1},e.next=7,this.setUserPromise;case 7:return this._hasConnectionID()||(h.watch=!1),f=st(st({filter_conditions:t,sort:s,user_details:this._user},h),r),e.next=11,this.get(this.baseURL+"/channels",{payload:f});case 11:p=e.sent,d=[],v=tt(p.channels);try{for(v.s();!(g=v.n()).done;)m=g.value,this._addChannelConfig(m)}catch(e){v.e(e)}finally{v.f()}w=tt(p.channels);try{for(w.s();!(b=w.n()).done;)k=b.value,(_=this.channel(k.channel.type,k.channel.id)).data=k.channel,_.initialized=!0,_._initializeState(k),d.push(_)}catch(e){w.e(e)}finally{w.f()}return e.abrupt("return",d);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=m(y.mark(function e(t,n){var r,s,i=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>2&&void 0!==i[2]?i[2]:{},s=st({filter_conditions:t},r),"string"!=typeof n){e.next=6;break}s.query=n,e.next=11;break;case 6:if("object"!==x(n)){e.next=10;break}s.message_filter_conditions=n,e.next=11;break;case 10:throw Error("Invalid type ".concat(x(n)," for query parameter"));case 11:return e.next=13,this.setUserPromise;case 13:return e.next=15,this.get(this.baseURL+"/search",{payload:s});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addDevice",value:function(){var e=m(y.mark(function e(t,n){var r,s=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:null,e.next=3,this.post(this.baseURL+"/devices",st({id:t,push_provider:n},null!=r?{user_id:r}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeDevice",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.delete(this.baseURL+"/devices",st({id:t},n?{user_id:n}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_addChannelConfig",value:function(e){this.configs[e.channel.type]=e.channel.config}},{key:"channel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call setUser or setAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));if(null==t||""===t)return new Ue(this,e,void 0,n||{});if("object"===x(t)&&2===arguments.length)return new Ue(this,e,void 0,t);if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in this.activeChannels){var s=this.activeChannels[r];return Object.keys(n).length>0&&(s.data=n,s._data=n),s}var i=new Ue(this,e,t,n);return this.activeChannels[i.cid]=i,i}},{key:"updateUser",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upsertUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"partialUpdateUser",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"upsertUsers",value:function(){var e=m(y.mark(function e(t){var n,r,s,i;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=tt(t),e.prev=2,r.s();case 4:if((s=r.n()).done){e.next=11;break}if((i=s.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[i.id]=i;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}},e,this,[[2,13,16,19]])}));return function(t){return e.apply(this,arguments)}}()},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"updateUsers",value:function(e){return this.upsertUsers(e)}},{key:"partialUpdateUsers",value:function(){var e=m(y.mark(function e(t){var n,r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=tt(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}},e,this,[[1,11,14,17]])}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"reactivateUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/reactivate"),st({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deactivateUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/deactivate"),st({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"exportUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(t,"/export"),st({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"banUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",st({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"unbanUser",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",st({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"muteUser",value:function(){var e=m(y.mark(function e(t){var n,r,s=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:null,r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=4,this.post(this.baseURL+"/moderation/mute",st(st({target_id:t},n?{user_id:n}:{}),r));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unmuteUser",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.post(this.baseURL+"/moderation/unmute",st({target_id:t},n?{user_id:n}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"flagMessage",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",st({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"flagUser",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",st({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unflagMessage",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",st({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unflagUser",value:function(){var e=m(y.mark(function e(t){var n,r=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",st({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"markAllRead",value:function(){var e=m(y.mark(function e(){var t,n=arguments;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",st({},t));case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createChannelType",value:function(e){var t=r({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(e))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(e),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(e))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:function(){var e=m(y.mark(function e(t,n){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(t,"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateMessage",value:function(){var e=m(y.mark(function e(t,n){var s;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMesssage");case 2:return delete(s=r({},t)).id,["latest_reactions","own_reactions","reply_count","reaction_counts","created_at","updated_at","html","command","type","user"].forEach(function(e){null!=s[e]&&delete s[e]}),null!=n&&("string"==typeof n||n instanceof String?s.user_id=n:s.user={id:n.id}),e.next=9,this.post(this.baseURL+"/messages/".concat(t.id),{message:s});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteMessage",value:function(){var e=m(y.mark(function e(t,n){var r;return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(t),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMessage",value:function(){var e=m(y.mark(function e(t){return y.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_userAgent",value:function(){return this.getUserAgent()}},{key:"getUserAgent",value:function(){return this.userAgent||"stream-chat-javascript-client-".concat(this.node?"node":"browser","-").concat(Ze)}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},t=this._getToken();return st({params:st(st({user_id:this.userID},e.params),{},{api_key:this.key,connection_id:this.connectionID}),headers:st({Authorization:t,"stream-auth-type":this.getAuthType(),"x-stream-client":this._userAgent()},e.headers)},e.config)}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval(function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}},500))}},{key:"verifyWebhook",value:function(e,t){return Ve(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/custom_permission/").concat(e))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/custom_permission"),st({},e))}},{key:"updatePermission",value:function(e,t){return this.post("".concat(this.baseURL,"/custom_permission/").concat(e),st({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/custom_permission/").concat(e))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/custom_permission"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/custom_role"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/custom_role"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/custom_role/").concat(e))}},{key:"sync",value:function(e,t){return this.post("".concat(this.baseURL,"/sync"),{channel_cids:e,last_sync_at:t})}}]),e}(),at=["*"],ot=["*"],ct=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:at,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ot,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"Allow";w(this,e),this.name=t,this.action=a,this.owner=i,this.priority=n,this.resources=r,this.roles=s},ut=new ct("Allow all",999,at,ot,!1,"Allow"),lt=new ct("Deny all",1,at,ot,!1,"Deny");e.StreamChat=it,e.logChatPromiseExecution=ge,e.ClientState=Ae,e.Channel=Ue,e.ChannelState=de,e.StableWSConnection=Ie,e.Allow="Allow",e.Deny="Deny",e.AnyResource=at,e.AnyRole=ot,e.MaxPriority=999,e.MinPriority=1,e.Permission=ct,e.AllowAll=ut,e.DenyAll=lt,e.BuiltinRoles={Anonymous:"anonymous",Guest:"guest",User:"user",Admin:"admin",ChannelModerator:"channel_moderator",ChannelMember:"channel_member"},e.BuiltinPermissions={CreateMessage:"Create Message",UpdateAnyMessage:"Update Any Message",UpdateOwnMessage:"Update Own Message",DeleteAnyMessage:"Delete Any Message",DeleteOwnMessage:"Delete Own Message",CreateChannel:"Create Channel",ReadAnyChannel:"Read Any Channel",ReadOwnChannel:"Read Own Channel",UpdateMembersAnyChannel:"Update Members Any Channel",UpdateMembersOwnChannel:"Update Members Own Channel",UpdateAnyChannel:"Update Any Channel",UpdateOwnChannel:"Update Own Channel",DeleteAnyChannel:"Delete Any Channel",DeleteOwnChannel:"Delete Own Channel",RunMessageAction:"Run Message Action",BanUser:"Ban User",UploadAttachment:"Upload Attachment",DeleteAnyAttachment:"Delete Any Attachment",DeleteOwnAttachment:"Delete Own Attachment",AddLinks:"Add Links",CreateReaction:"Create Reaction",DeleteAnyReaction:"Delete Any Reaction",DeleteOwnReaction:"Delete Own Reaction"},e.EVENT_MAP=ve,e.isValidEventType=ye,e.JWTUserToken=Je,e.JWTServerToken=$e,e.UserFromToken=Ke,e.DevToken=Ge,e.CheckSignature=Ve,e.encodeBase64=We,e.decodeBase64=He,e.TokenManager=et}(this.window=this.window||{});
//# sourceMappingURL=browser.full-bundle.min.js.map
